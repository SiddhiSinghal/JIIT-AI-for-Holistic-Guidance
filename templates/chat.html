<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ chat_type }} Chat - JIIT AI Hub</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header class="header">
    <div class="header-container">
      <div class="logo-section">
        <img src="{{ url_for('static', filename='images/jiit-logo.png') }}" alt="JIIT Logo" class="logo-img">
        <div class="logo-text">
          <div class="logo-title">JIIT AI Hub</div>
          <div class="logo-subtitle">Holistic Guidance Platform</div>
        </div>
      </div>
      <nav class="nav-links">
        <a href="/" class="nav-link">
          <i class="fas fa-home"></i> Dashboard
        </a>
        <a href="/profile" class="nav-link">
          <i class="fas fa-user"></i> Profile
        </a>
        <a href="/logout" class="nav-link">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </nav>
    </div>
  </header>

  <aside class="side-panel">
    <h3 class="side-panel-title">
      <i class="fas fa-compass"></i> Navigate Features
    </h3>
    <nav class="panel-nav">
      <a href="/chat" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-comments"></i></span>
        <span class="panel-label">Unified Chat</span>
      </a>
      <a href="/chat?mode=career" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-brain"></i></span>
        <span class="panel-label">Career Guidance</span>
      </a>
      <a href="/chat?mode=health_guidance" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-heart"></i></span>
        <span class="panel-label">Health Guidance</span>
      </a>
      <a href="/chat?mode=linkedin" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-linkedin"></i></span>
        <span class="panel-label">LinkedIn Post Generator</span>
      </a>
      <a href="/profile" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-chart-line"></i></span>
        <span class="panel-label">Skill Profiling</span>
      </a>
      <a href="/chat?mode=electives" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-graduation-cap"></i></span>
        <span class="panel-label">Elective Suggestions</span>
      </a>
      <a href="/chat?mode=jobs" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-briefcase"></i></span>
        <span class="panel-label">Job Recommendations</span>
      </a>
      <a href="/chat?mode=mooc" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-book-open"></i></span>
        <span class="panel-label">MOOC Courses</span>
      </a>
      <a href="/chat?mode=market_score" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-chart-bar"></i></span>
        <span class="panel-label">Market Analysis</span>
      </a>
      <a href="/aptitude_test" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-brain"></i></span>
        <span class="panel-label">Aptitude Test</span>
      </a>
      <a href="/communication_test" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-comments"></i></span>
        <span class="panel-label">Communication Test</span>
      </a>
      <a href="/creativity_test" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-lightbulb"></i></span>
        <span class="panel-label">Creativity Test</span>
      </a>
      <a href="/coding_test" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-code"></i></span>
        <span class="panel-label">Coding Test</span>
      </a>
    </nav>
  </aside>

  <main class="main-content with-sidebar">
    <div class="chat-container">
      <div class="chat-header">
        <i class="fas fa-comments"></i>
        <span class="chat-header-title">{{ chat_type }} Guidance Chat</span>
      </div>

      <div class="chat-messages" id="chatBox">
        {% if chat_history %}
          {% for msg in chat_history %}
            <div class="message {% if msg.sender == 'user' %}user{% else %}bot{% endif %}">
              <div class="message-avatar">
                {% if msg.sender == 'user' %}
                  <i class="fas fa-user"></i>
                {% else %}
                  <i class="fas fa-robot"></i>
                {% endif %}
              </div>
              <div class="message-content"
                   {% if msg.action %} data-action="{{ msg.action }}" data-test-url="{{ msg.test_url }}" {% endif %}>
                {% if msg.html %}
                  {{ msg.text | safe }}
                {% else %}
                  {{ msg.text }}
                {% endif %}
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="message bot">
            <div class="message-avatar">
              <i class="fas fa-robot"></i>
            </div>
            <div class="message-content">
              <strong>ðŸ‘‹ Hello!</strong><br><br>
              I'm your AI assistant for <strong>{{ chat_type }}</strong> guidance. 
              Feel free to ask me anything - I'm here to help you succeed!
            </div>
          </div>
        {% endif %}
      </div>

      <div class="chat-input-area">
        <form method="POST" class="chat-input-form">
          <input 
            type="text" 
            name="prompt" 
            class="chat-input" 
            placeholder="Type your message here..." 
            required
            autocomplete="off"
          >
          <button type="submit" class="chat-send-btn">
            <i class="fas fa-paper-plane"></i>
            Send
          </button>
        </form>
      </div>
    </div>
  </main>

  <footer style="background: var(--jiit-dark); color: white; text-align: center; padding: 2rem; margin-top: 3rem; margin-left: 280px;">
    <p>&copy; 2025 JIIT AI Hub - Holistic Guidance Platform. All rights reserved.</p>
    <p style="margin-top: 1rem; opacity: 0.9; font-size: 0.875rem; line-height: 1.6;">
      Developed by students under the CoE on AI for Education, Jaypee Institute of Information Technology, Noida, India.
    </p>
    <p style="margin-top: 1rem; opacity: 0.85; font-size: 0.8125rem; line-height: 1.5;">
      <strong>Contributors:</strong> Daksh Jain, Ishika Arora, Lokendra Singh Shekhawat, Mahi Aggarwal, Priyanshu Bansal, Sehal Saxena, Shivang Mishra, Siddhi Singhal
    </p>
    <p style="margin-top: 0.75rem; opacity: 0.85; font-size: 0.8125rem;">
      <strong>Mentor:</strong> Dr. Anita Sahoo, Associate Professor, Dept. of CS&E and IT
    </p>
  </footer>

  <script>
    const chatBox = document.getElementById("chatBox");
    chatBox.scrollTop = chatBox.scrollHeight;

    const currentParams = new URLSearchParams(window.location.search);
    const mode = currentParams.get('mode');
    
    document.querySelectorAll('.panel-nav-item').forEach(item => {
      const href = item.getAttribute('href');
      if (href && mode && href.includes(`mode=${mode}`)) {
        item.classList.add('active');
      }
    });

    function openTestIfRequired() {
      const aiMessages = document.querySelectorAll(".bot .message-content");
      for (let el of aiMessages) {
        const action = el.getAttribute("data-action");
        const testUrl = el.getAttribute("data-test-url");
        if (action === "start_test" && testUrl) {
          window.open(testUrl, "_blank", "noopener,noreferrer");

          el.removeAttribute("data-action");
          el.removeAttribute("data-test-url");

          const confirmMsg = document.createElement("div");
          confirmMsg.className = "message bot";
          confirmMsg.innerHTML = `
            <div class="message-avatar">
              <i class="fas fa-robot"></i>
            </div>
            <div class="message-content">
              <strong>ðŸš€ Your test has been opened in a new tab.</strong><br>
              Complete it and come back here once done!
            </div>`;
          chatBox.appendChild(confirmMsg);
          chatBox.scrollTop = chatBox.scrollHeight;
          break;
        }
      }
    }

    window.addEventListener("load", openTestIfRequired);

    document.querySelector('.chat-input-form').addEventListener('submit', function() {
      const btn = this.querySelector('.chat-send-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="loading-spinner"></span> Sending...';
    });
  </script>
</body>
</html>
