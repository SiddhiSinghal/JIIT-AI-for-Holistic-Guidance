<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - JIIT AI Hub</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .profile-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 2rem;
      margin-bottom: 2rem;
    }
    .profile-card h5 {
      color: var(--jiit-blue);
      margin-bottom: 1.5rem;
      font-weight: 600;
    }
    .upload-section {
      border: 2px dashed #ccc;
      border-radius: 8px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s;
    }
    .upload-section:hover {
      border-color: var(--jiit-blue);
      background-color: #f8f9fa;
    }
    .upload-btn {
      background: var(--jiit-blue);
      color: white;
      padding: 0.75rem 2rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .upload-btn:hover {
      background: #2c5aa0;
      transform: translateY(-2px);
    }
    .marksheet-item {
      background: #f8f9fa;
      border-left: 4px solid var(--jiit-blue);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .marksheet-header {
      color: var(--jiit-blue);
      font-weight: 600;
      margin-bottom: 0.75rem;
    }
    .grade-table {
      width: 100%;
      margin-top: 1rem;
      border-collapse: collapse;
    }
    .grade-table th {
      background: var(--jiit-dark);
      color: white;
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
    }
    .grade-table td {
      padding: 0.75rem;
      border-bottom: 1px solid #ddd;
    }
    .grade-table tr:hover {
      background-color: #f1f1f1;
    }
    .no-data {
      text-align: center;
      color: #888;
      padding: 2rem;
      font-style: italic;
    }
    .test-results-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    .test-results-table th {
      background: var(--jiit-blue);
      color: white;
      padding: 1rem;
      text-align: left;
      font-weight: 600;
    }
    .test-results-table td {
      padding: 1rem;
      border-bottom: 1px solid #ddd;
    }
    .test-results-table tr:hover {
      background-color: #f1f1f1;
    }
    .flash-messages {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 1000;
      max-width: 400px;
    }
    .alert {
      padding: 1rem 1.5rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    .alert-success {
      background: #d4edda;
      color: #155724;
      border-left: 4px solid #28a745;
    }
    .alert-warning {
      background: #fff3cd;
      color: #856404;
      border-left: 4px solid #ffc107;
    }
    .alert-danger {
      background: #f8d7da;
      color: #721c24;
      border-left: 4px solid #dc3545;
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-container">
      <div class="logo-section">
        <img src="{{ url_for('static', filename='images/jiit-logo.png') }}" alt="JIIT Logo" class="logo-img">
        <div class="logo-text">
          <div class="logo-title">JIIT AI Hub</div>
          <div class="logo-subtitle">Holistic Guidance Platform</div>
        </div>
      </div>
      <nav class="nav-links">
        <a href="/" class="nav-link">
          <i class="fas fa-home"></i> Dashboard
        </a>
        <a href="/profile" class="nav-link active">
          <i class="fas fa-user"></i> Profile
        </a>
        <a href="/logout" class="nav-link">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </nav>
    </div>
  </header>

  <aside class="side-panel">
    <h3 class="side-panel-title">
      <i class="fas fa-compass"></i> Navigate Features
    </h3>
    <nav class="panel-nav">
      <a href="/chat" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-comments"></i></span>
        <span class="panel-label">Unified Chat</span>
      </a>
      <a href="/chat?mode=career" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-brain"></i></span>
        <span class="panel-label">Career Guidance</span>
      </a>
      <a href="/chat?mode=mental_health" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-heart"></i></span>
        <span class="panel-label">Mental Health</span>
      </a>
      <a href="/chat?mode=linkedin" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-linkedin"></i></span>
        <span class="panel-label">LinkedIn Post Generator</span>
      </a>
      <a href="/profile" class="panel-nav-item active">
        <span class="panel-icon"><i class="fas fa-chart-line"></i></span>
        <span class="panel-label">Skill Profiling</span>
      </a>
      <a href="/chat?mode=electives" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-graduation-cap"></i></span>
        <span class="panel-label">Elective Suggestions</span>
      </a>
      <a href="/chat?mode=jobs" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-briefcase"></i></span>
        <span class="panel-label">Job Recommendations</span>
      </a>
      <a href="/chat?mode=mooc" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-book-open"></i></span>
        <span class="panel-label">MOOC Courses</span>
      </a>
      <a href="/chat?mode=market_score" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-chart-bar"></i></span>
        <span class="panel-label">Market Analysis</span>
      </a>
      <a href="/aptitude_test" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-brain"></i></span>
        <span class="panel-label">Aptitude Test</span>
      </a>
      <a href="/communication_test" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-comments"></i></span>
        <span class="panel-label">Communication Test</span>
      </a>
      <a href="/creativity_test" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-lightbulb"></i></span>
        <span class="panel-label">Creativity Test</span>
      </a>
      <a href="/coding_test" class="panel-nav-item">
        <span class="panel-icon"><i class="fas fa-code"></i></span>
        <span class="panel-label">Coding Test</span>
      </a>
    </nav>
  </aside>

  <main class="main-content with-sidebar">
    <div class="container" style="max-width: 1200px; padding: 2rem;">
      
      <!-- Flash Messages -->
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <div class="flash-messages">
            {% for message in messages %}
              <div class="alert {% if '✅' in message %}alert-success{% elif '⚠️' in message %}alert-warning{% else %}alert-danger{% endif %}">
                {{ message }}
              </div>
            {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <h2 style="color: var(--jiit-dark); margin-bottom: 2rem;">
        <i class="fas fa-user-circle"></i> {{ user }}'s Profile & Skill Analysis
      </h2>

      <!-- Upload Form -->
      <div class="profile-card">
        <h5><i class="fas fa-upload"></i> Upload Marksheet (PDF)</h5>
        <form method="POST" enctype="multipart/form-data">
          <div class="upload-section">
            <i class="fas fa-file-pdf" style="font-size: 3rem; color: var(--jiit-blue); margin-bottom: 1rem;"></i>
            <p style="margin-bottom: 1rem; color: #666;">Upload your academic marksheet to analyze your skills and strengths</p>
            <input type="file" name="file" accept=".pdf" required style="margin-bottom: 1rem;">
            <br>
            <button type="submit" class="upload-btn">
              <i class="fas fa-cloud-upload-alt"></i> Upload & Analyze
            </button>
          </div>
        </form>
      </div>

      <!-- Uploaded Mark Sheets -->
      <div class="profile-card">
        <h5><i class="fas fa-graduation-cap"></i> Academic Performance</h5>

        {% if user_data.marksheets and user_data.marksheets|length > 0 %}
          {% for sheet in user_data.marksheets %}
          <div class="marksheet-item">
            <div class="marksheet-header">
              <i class="fas fa-book"></i> Semester {{ sheet.semester }} — {{ sheet.branch }}
            </div>
            <p style="margin: 0.5rem 0;">
              <strong>SGPA:</strong> <span style="color: var(--jiit-blue);">{{ sheet.sgpa }}</span> | 
              <strong>CGPA:</strong> <span style="color: var(--jiit-blue);">{{ sheet.cgpa }}</span>
            </p>

            {% if sheet.subjects and sheet.subjects|length > 0 %}
            <table class="grade-table">
              <thead>
                <tr>
                  <th><i class="fas fa-book-open"></i> Subject</th>
                  <th><i class="fas fa-award"></i> Grade</th>
                </tr>
              </thead>
              <tbody>
                {% for subj in sheet.subjects %}
                <tr>
                  <td>{{ subj.subject }}</td>
                  <td><strong>{{ subj.grade }}</strong></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            {% else %}
              <p class="no-data">No subjects found in this marksheet.</p>
            {% endif %}
          </div>
          {% endfor %}
        {% else %}
          <div class="no-data">
            <i class="fas fa-inbox" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
            <p>No marksheets uploaded yet. Upload your first marksheet above to get started!</p>
          </div>
        {% endif %}
      </div>

      <!-- Test Results Section -->
      <div class="profile-card">
        <h5><i class="fas fa-clipboard-check"></i> Assessment Results</h5>
        
        {% if assessments and assessments|length > 0 %}
          <table class="test-results-table">
            <thead>
              <tr>
                <th><i class="fas fa-tasks"></i> Test Type</th>
                <th><i class="fas fa-star"></i> Score</th>
                <th><i class="fas fa-calendar"></i> Date Taken</th>
              </tr>
            </thead>
            <tbody>
              {% for a in assessments %}
              <tr>
                <td><strong>{{ a.type }}</strong></td>
                <td>{{ a.score }}</td>
                <td>{{ a.date }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <div class="no-data">
            <i class="fas fa-clipboard-list" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
            <p>No assessments taken yet. Take a test from the sidebar to build your comprehensive profile!</p>
          </div>
        {% endif %}
      </div>

    </div>
  </main>

  <script>
    // Auto-hide flash messages after 5 seconds
    setTimeout(function() {
      const alerts = document.querySelectorAll('.alert');
      alerts.forEach(alert => {
        alert.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => alert.remove(), 300);
      });
    }, 5000);

    // Highlight active sidebar item
    document.querySelectorAll('.panel-nav-item').forEach(item => {
      const href = item.getAttribute('href');
      if (href === '/profile') {
        item.classList.add('active');
      }
    });
  </script>
</body>
</html>
